(function(b){function a(a){if("string"===typeof a.data){var c=a.handler,f=a.data.toLowerCase().split(" ");a.handler=function(a){if(!(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type||"true"==$(a.target).prop("contenteditable")))){var d="keypress"!==a.type&&b.hotkeys.specialKeys[a.which],i=String.fromCharCode(a.which).toLowerCase(),h="",j={};a.altKey&&"alt"!==d&&(h+="alt+");a.ctrlKey&&"ctrl"!==d&&(h+="ctrl+");a.metaKey&&!a.ctrlKey&&"meta"!==d&&(h+="meta+");a.shiftKey&&
"shift"!==d&&(h+="shift+");d?j[h+d]=!0:(j[h+i]=!0,j[h+b.hotkeys.shiftNums[i]]=!0,"shift+"===h&&(j[b.hotkeys.shiftNums[i]]=!0));d=0;for(i=f.length;d<i;d++)if(j[f[d]])return c.apply(this,arguments)}}}}b.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",
103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",188:",",190:".",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};b.each(["keydown","keyup","keypress"],function(){b.event.special[this]={add:a}})})(jQuery);
function TextSelector(b){if("undefined"===typeof b)throw"Failed to find passed element";b instanceof jQuery&&(b=b[0]);this.parent=b;this._stored=null;this.get=function(){if("undefined"!==typeof b.selectionStart)return{start:b.selectionStart,end:b.selectionEnd,length:b.selectionEnd-b.selectionStart};var a=document.selection.createRange(),d=a.duplicate();d.moveToElementText(b);d.setEndPoint("EndToEnd",a);d=d.text.length-a.text.length;return{start:d,end:d+a.text.length,length:a.text.length}};this.replace=
function(a){if("undefined"!==typeof b.selectionStart)return b.value=b.value.substr(0,b.selectionStart)+a+b.value.substr(b.selectionEnd),this;b.focus();document.selection.createRange().text=a;return this};this.store=function(){this._stored=this.get()};this.load=function(){this.select(this._stored)};this.select=function(a,d){"undefined"!==typeof a.start&&(d=a.end,a=a.start);if("undefined"!==typeof b.setSelectionRange)b.focus(),b.setSelectionRange(a,d);else if("undefined"!==typeof b.createTextRange){var c=
b.createTextRange();c.collapse(!0);c.moveEnd("character",d);c.moveStart("character",a);c.select()}return this};this.isSelected=function(){return 0!==this.get().length};this.text=function(){return"undefined"!==typeof document.selection?document.selection.createRange().text:b.value.substr(b.selectionStart,b.selectionEnd-b.selectionStart)}}String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(b,a,d){return a+d.toUpperCase()})};
(function(b){b.griffinEditorExtension={textHandler:null,imageDialog:function(a){0==b("#griffin-image-dialog").length&&b('<div class="modal fade form-horizontal" id="griffin-image-dialog"><div class="modal-header"><a class="close" data-dismiss="modal">\u00d7</a><h3>\u63d2\u5165\u56fe\u7247</h3></div><div class="modal-body"><div class="control-group"><label class="control-label" for="focusedInput">\u56fe\u7247\u6807\u9898</label><div class="controls"><input class="input" name="griffin-image-title" type="text" placeholder="\u56fe\u7247\u6807\u9898"></div></div><div class="control-group"><label class="control-label">\u56fe\u7247\u5730\u5740</label><div class="controls"><input class="input" name="griffin-image-url" type="text" placeholder="\u56fe\u7247\u5730\u5740"></div></div></div><div class="modal-footer"><button class="btn btn-danger">\u53d6\u6d88</button><button class="btn btn-primary">\u63d2\u5165\u56fe\u7247</button></div></div>').appendTo("body");
b("#griffin-image-dialog").modal("show");b("#griffin-image-dialog .btn-primary").click(function(){var c=b('input[name="griffin-image-title"]'),f=b('input[name="griffin-image-url"]');""!=c.val()&&""!=f.val()?(a.success({url:f.val(),title:c.val()}),b("#griffin-image-dialog").modal("hide")):(""===c.val()?c.parent().parent().addClass("error"):c.parent().parent().removeClass("error"),""===f.val()?f.parent().parent().addClass("error"):f.parent().parent().removeClass("error"))});b("#griffin-image-dialog .btn-danger").click(function(){b("#griffin-image-dialog").modal("hide")});
b("#griffin-image-dialog").on("hidden",function(){b("#griffin-image-dialog").remove()})},linkDialog:function(a){0==b("#griffin-link-dialog").length&&b('<div class="modal fade form-horizontal" id="griffin-link-dialog"><div class="modal-header"><a class="close" data-dismiss="modal">\u00d7</a><h3>\u63d2\u5165\u94fe\u63a5</h3></div><div class="modal-body"><div class="control-group"><label class="control-label" for="focusedInput">\u94fe\u63a5\u6807\u9898</label><div class="controls"><input class="input" name="griffin-link-title" type="text" placeholder="\u94fe\u63a5\u6807\u9898"></div></div><div class="control-group"><label class="control-label">\u94fe\u63a5\u5730\u5740</label><div class="controls"><input class="input" name="griffin-link-url" type="text" placeholder="\u94fe\u63a5\u5730\u5740"></div></div></div><div class="modal-footer"><button class="btn btn-danger">\u53d6\u6d88</button><button class="btn btn-primary">\u63d2\u5165\u94fe\u63a5</button></div></div>').appendTo("body");
b("#griffin-link-dialog").modal("show");b("#griffin-link-dialog .btn-primary").click(function(){var c=b('input[name="griffin-link-title"]'),f=b('input[name="griffin-link-url"]');""!=c.val()&&""!=f.val()?(a.success({url:f.val(),title:c.val()}),b("#griffin-link-dialog").modal("hide")):(""===c.val()?c.parent().parent().addClass("error"):c.parent().parent().removeClass("error"),""===f.val()?f.parent().parent().addClass("error"):f.parent().parent().removeClass("error"))});b("#griffin-link-dialog .btn-danger").click(function(){b("#griffin-link-dialog").modal("hide")});
b("#griffin-link-dialog").on("hidden",function(){b("#griffin-link-dialog").remove()})}};b.griffinEditor={texts:{title:"Please wait, loading.."},translations:[]};var a={init:function(d){var c=b.extend({textHandler:b.griffinEditorExtension.textHandler,autoSize:!1},d);return this.each(function(){var d=b(this),g=this,e=d.data("griffin-editor");this.trimSpaceInSelection=function(){var a=e.selection.text(),b=e.selection.get();" "===a.substr(a.length-1,1)&&e.selection.select(b.start,b.end-1)};this.getActionNameFromClass=
function(a){for(var a=a.split(/\s+/),b=0;b<a.length;b++)if("button-"===a[b].substr(0,7))return a[b].substr(7);return null};this.assignAccessKeys=function(){b("span[accesskey]",e.toolbar).each(function(){var d=this;jQuery.hotkeys&&b(e.editor).bind("keydown","ctrl+"+b(this).attr("accesskey"),function(b){b.preventDefault();var b=g.getActionNameFromClass(d.className),c=[];c[0]=b;a.invokeAction.apply(g,c);g.preview();return this})})};this.preview=function(){if(0===e.preview.length)return this;e.options.textHandler.preview(g,
e.preview,e.editor.val());if("undefined"===typeof hljs)return this;var a=b(this).data("editor-timer");"undefined"!==typeof a&&clearTimeout(a);a=setTimeout(function(){hljs.tabReplace="    ";var a=b("code",e.preview).html();null!==a&&(a=hljs.highlightAuto(a),b("code",e.preview).html(a.value))},1E3);b(this).data("editor-timer",a);return this};this.autoSize=function(){if(!e.options.autoSize)return this;var a=b(this).data("twin-area");"undefined"===typeof a&&(a=b('<textarea style="position:absolute; top: -10000px"></textarea>'),
a.appendTo("body"),b(this).data("twin-area",a),b(this).data("originalSize",{width:e.editor[0].clientWidth,height:e.editor[0].clientHeight,top:e.editor.css("top"),left:e.editor.css("left")}));a.css("height",e.editor[0].clientHeight);a.css("width",e.editor[0].clientWidth);a.html(e.editor.val()+"some\r\nmore\r\n");a[0].clientHeight<a[0].scrollHeight&&(a={height:e.editor[0].clientHeight+100+"px",width:e.editor[0].clientWidth,top:e.editor.offset().top,left:e.editor.offset().left},b(e.editor).css(a),b(this).data("expandedSize",
a));return this};if("undefined"!==typeof e)return this;b('.toolbar span[class^="button"]',this).click(function(b){b.preventDefault();var b=g.getActionNameFromClass(this.className),d=[];d[0]=b;a.invokeAction.apply(g,d);g.preview();return this});b("textarea",this).bind("paste",function(){setTimeout(function(){g.preview()},100)});b("textarea",this).keyup(function(){g.preview();g.autoSize()});b("textarea",this).blur(function(){if(e.options.autoSize){var a=b(this).data("originalSize");"undefined"!==typeof a&&
b(e.editor).css(a)}});b("textarea",this).focus(function(){if(e.options.autoSize){var a=b(this).data("expandedSize");"undefined"!==typeof a&&b(e.editor).css(a)}});e={};e.toolbar=b(".toolbar",d);e.editor=b("textarea",d);e.selection=new TextSelector(e.editor);e.preview=b("#"+d.attr("id")+"-preview");e.options=c;b(this).data("griffin-editor",e);this.assignAccessKeys();this.preview();return this})},destroy:function(){return this.each(function(){var a=b(this),c=a.data("overlay");b(window).unbind(".elementOverlay");
c.overlay.remove();a.removeData("overlay")})},invokeAction:function(a){var c=b(this).data("griffin-editor");this.trimSpaceInSelection();c.options.textHandler.invokeAction(this,a,c.selection,{})},preview:function(){b(this).data("griffin-editor");this.preview()}};b.fn.griffinEditor=function(d){if(a[d])return a[d].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof d||!d)return a.init.apply(this,arguments);b.error("Method "+d+" does not exist on jQuery.griffinEditor")}})(jQuery);
(function(b){b.griffinEditorExtension.textHandler={invokeAction:function(a,b,c,f){f.editor=a;a="action"+b.capitalize();if(this[a])return b=[],b[0]=c,b[1]=f,this[a].apply(this,b);"undefined"!==typeof alert&&alert("Missing "+a+" in the active textHandler (griffinEditorExtension)");return this},preview:function(a,d,c){if(null===c||"undefined"===typeof c)return"undefined"!==typeof alert&&alert("Empty contents"),this;d.html(b.markdown(c))},removeWrapping:function(a,d){var c=d.length,f=b(a.parent),g=a.get();
0!==g.start&&f.val().substr(g.start-c,c)===d&&(a.select(g.start-c,g.end+c),g=a.get());return a.text().substr(0,c)===d?(f=a.text().substr(c,a.text().length-2*c),a.replace(f),a.select(g.start,g.end-2*c),!0):!1},actionBold:function(a){var b=a.isSelected(),c=a.get();if(this.removeWrapping(a,"**"))return this;a.replace("**"+a.text()+"**");b?a.select(c.start,c.end+4):a.select(c.start+2,c.start+2);return this},actionItalic:function(a){var b=a.isSelected(),c=a.get();if(this.removeWrapping(a,"_"))return this;
a.replace("_"+a.text()+"_");b?a.select(c.start,c.end+2):a.select(c.start+1,c.start+1);return this},actionH1:function(a){var b=a.isSelected(),c=a.get();a.replace("# "+a.text());b&&a.select(c.end+2,c.end+2);return this},actionH2:function(a){var b=a.isSelected(),c=a.get();a.replace("## "+a.text());b&&a.select(c.end+3,c.end+3)},actionH3:function(a){a.isSelected();var b=a.get();a.replace("### "+a.text());a.select(b.end+4,b.end+4);return this},actionH4:function(a){a.isSelected();var b=a.get();a.replace("#### "+
a.text());a.select(b.end+5,b.end+5);return this},actionH5:function(a){a.isSelected();var b=a.get();a.replace("##### "+a.text());a.select(b.end+6,b.end+6);return this},actionH6:function(a){a.isSelected();var b=a.get();a.replace("###### "+a.text());a.select(b.end+7,b.end+7);return this},actionBullets:function(a){a.isSelected();var b=a.get();a.replace("* "+a.text());a.select(b.end+2,b.end+2);return this},actionNumbers:function(a){a.isSelected();var b=a.get();a.replace("1. "+a.text());a.select(b.end+
3,b.end+3);return this},actionSourcecode:function(a){var b=a.get();if(!a.isSelected())return a.replace("```python\n\n```"),a.select(b.start+10,b.start+10),this;if(-1===a.text().indexOf("\n"))return a.replace("```python\n"+a.text()+"\n```"),a.select(b.end+10,b.end+10),this;var c="    "+a.text().replace(/\n/g,"\n    ");" "===c.substr(c.length-3,1)&&" "===c.substr(c.length-1,1)&&(c=c.substr(0,c.length-4));a.replace(c);a.select(b.start+c.length,b.start+c.length);return this},actionQuote:function(a){var b=
a.get();if(!a.isSelected())return a.replace("> "),a.select(b.start+2,b.start+2),this;var c="> "+a.text().replace(/\n/g,"\n> ");" "===c.substr(c.length-3,1)&&(c=c.substr(0,c.length-4));a.replace(c);a.select(b.start+c.length,b.start+c.length);return this},actionImage:function(a,d){var c=a.get(),f=a.text();a.store();var g={success:function(b){b="!["+b.title+"]("+b.url+")";a.load();a.replace(b);a.select(c.start+b.length,c.start+b.length);d.editor.preview()}};a.isSelected()?".png"===f.substr(-4,4)||".gif"===
f.substr(-4,4)||".jpg"===f.substr(-4,4)?g.url=f:g.title=f:(g.url="",g.title="");b.griffinEditorExtension.imageDialog(g);return this},actionLink:function(a,d){var c=a.get(),f=a.text();a.store();var g={success:function(b){a.load();b="["+b.title+"]("+b.url+"/)";a.replace(b);a.select(c.start+b.length,c.start+b.length);d.editor.preview()}};a.isSelected()&&("http"===f.substr(0,4)||"www"===f.substr(0,3)?g.url=f:g.title=f);b.griffinEditorExtension.linkDialog(g);return this}}})(jQuery);
(function(b){b.fn.markdown=function(){0>=b(".toolbar").length&&(b('<div class="toolbar btn-toolbar" style="margin-top:0;"><div class="btn-group"><span class="button-h1 btn" accesskey="1" title="\u6807\u98981 [Ctrl + 1]"><strong>H1</strong></span><span class="button-h2 btn" accesskey="2" title="\u6807\u98982 [Ctrl + 2]"><strong>H2</strong></span><span class="button-h3 btn" accesskey="3" title="\u6807\u98983 [Ctrl + 3]"><strong>H3</strong></span><span class="button-h4 btn" accesskey="4" title="\u6807\u98984 [Ctrl + 4]"><strong>H4</strong></span><span class="button-h5 btn" accesskey="5" title="\u6807\u98985 [Ctrl + 5]"><strong>H5</strong></span><span class="button-h6 btn" accesskey="6" title="\u6807\u98986 [Ctrl + 6]"><strong>H6</strong></span></div><div class="btn-group"><span class="button-bold btn" accesskey="b" title="\u52a0\u7c97 [Ctrl + B]"><strong>B</strong></span><span class="button-italic btn" accesskey="i" title="\u659c\u4f53 [Ctrl + I]"><strong><em>I</em></strong></span><span class="button-sourcecode btn" accesskey="k" title="\u63d2\u5165\u4ee3\u7801 [Ctrl + K]"><strong>C</strong></span><span class="button-link btn" accesskey="l" title="\u63d2\u5165\u94fe\u63a5 [Ctrl + L]"><strong>L</strong></span></div><div class="btn-group"><span class="button-bullets btn" accesskey="u" title="\u5217\u8868 [Ctrl + U]"><i class="icon-list"></i></span><span class="button-numbers btn" accesskey="o" title="\u6392\u5e8f\u5217\u8868 [Ctrl + O]"><i class="icon-th-list"></i></span><span class="button-image btn" accesskey="p" title="\u63d2\u5165\u56fe\u7247 [Ctrl + P]"><i class="icon-picture"></i></span></div></div>').prependTo(this),
b(".toolbar span").tooltip());this.griffinEditor()}})(jQuery);
